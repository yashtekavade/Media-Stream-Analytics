SQL Setup
CREATE OR REPLACE DATABASE TBSM_DB;

CREATE OR REPLACE SCHEMA TBSM_DB.PUBLIC;

CREATE OR REPLACE WAREHOUSE COMPUTE_WH
WITH WAREHOUSE_SIZE = XSMALL
AUTO_SUSPEND = 300
AUTO_RESUME = TRUE
INITIALLY_SUSPENDED = TRUE;


CREATE OR REPLACE TABLE TBSM_DB.PUBLIC.VIEWERSHIP_LOGS (
    session_id STRING,
    user_id STRING,
    channel_id STRING,
    channel_name STRING,
    show_name STRING,
    genre STRING,
    timestamp STRING,
    duration_minutes STRING,
    region STRING,
    subscription_type STRING,
    device STRING,
    platform STRING,
    is_live STRING,
    ads_watched STRING,
    ad_revenue STRING,
    engagement_score STRING,
    buffer_count STRING,
    completion_percentage STRING
);


CREATE OR REPLACE USER spark_user
PASSWORD = 'StrongPassword@123'
DEFAULT_ROLE = ACCOUNTADMIN
DEFAULT_WAREHOUSE = COMPUTE_WH
DEFAULT_NAMESPACE = TBSM_DB.PUBLIC
MUST_CHANGE_PASSWORD = FALSE;


GRANT USAGE ON WAREHOUSE COMPUTE_WH TO USER spark_user;
GRANT USAGE ON DATABASE TBSM_DB TO USER spark_user;
GRANT USAGE ON SCHEMA TBSM_DB.PUBLIC TO USER spark_user;
GRANT INSERT, SELECT ON ALL TABLES IN SCHEMA TBSM_DB.PUBLIC TO USER spark_user;

